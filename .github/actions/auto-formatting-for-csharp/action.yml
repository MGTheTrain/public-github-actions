name: Auto-formatting C# library repos
description: Auto-formatting C# library repos

inputs:
  SRC_WORKING_DIRECTORY:
    required: true
    default: "./libraries/c#/src/CommonLib"
    description: 'The source working directory in which the code resides.'
  TEST_WORKING_DIRECTORY:
    required: true
    default: "./libraries/c#/test"
    description: 'The test working directory in which the code resides.'
  GH_TOKEN:
    required: true
    default: "<>"
    description: 'The Github Personal access token for auth and authz.'

# See: https://dev.to/srmagura/c-linting-and-formatting-tools-in-2021-bna, https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-format

runs:
  using: composite
  steps:
  - name: Setup dotnet
    uses: actions/setup-dotnet@v3
    with:
      dotnet-version: '8.0.x'
  - name: Install dotnet-format
    shell: bash
    run: dotnet tool install -g dotnet-format
  - name: Auto-format test folder
    shell: bash
    run: find . -name '*.csproj' -exec dotnet format {} \; 
    working-directory: ${{ inputs.TEST_WORKING_DIRECTORY }}
  - name: Auto-format src folder
    shell: bash
    run: dotnet format .
    working-directory: ${{ inputs.SRC_WORKING_DIRECTORY }}
  - name: Commit changes
    shell: bash
    env:
      GH_TOKEN: ${{ inputs.GH_TOKEN }}
    run: |
      git config --global user.name 'github-actions[bot]'
      git config --global user.email github-actions[bot]@users.noreply.github.com
      git pull
      git add -A
      git diff-index --quiet HEAD || git commit -m "Formatted cpp project with clang-format"
      git push